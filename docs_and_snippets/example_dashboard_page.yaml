title: Helios Vallox Ventilation
type: sections
path: ventilation2026-01
header: {}
badges: []
cards: []
max_columns: 4
dense_section_placement: true
layout:
  grid-template-columns: 1fr 1fr
  grid-template-rows: auto
  grid-gap: 16px
sections:
  - type: grid
    cards:
      - type: heading
        icon: " "
        heading_style: title
        style: |
          ha-card {
            height: 240px;
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
          }
      - type: picture-elements
        name: Remote_Control
        show_state: false
        show_name: false
        panel: true
        image: /local/community/helios_vallox_ventilation/rc_background.png
        card_mod:
          style: |
            ha-card { 
              background: transparent;
              --ha-card-border-color: rgba(0,0,0,0);
              --ha-card-border-radius: 0px;
              --ha-card-border-width: 0px;
            }
        elements:
          - type: custom:button-card
            name: __init_i18n__
            show_name: false
            show_icon: false
            tap_action:
              action: null
            styles:
              card:
                - display: none
            custom_fields:
              init: |
                [[[
                  const KEY = "helios.i18n.display";
                  const detectLang = () => {
                    const detected =
                      (typeof hass !== "undefined" && hass?.language ? hass.language : (navigator?.language || "de"))
                      .split("-")[0];
                    return ["de","en","fr","es","nl","da","sv","no","fi"].includes(detected) ? detected : "de";
                  };
                  const defaults = {
                    de: {
                      temp_titles: ["Außenluft", "Zuluft", "Abluft", "Fortluft"],
                      page2_title: "Lüftungsstufe setzen",
                      page3_title: "Stoßlüftung / Reduzierte Lüftung",
                      label_fanspeed: "Lüfterstufe",
                      label_minutes: "Minuten",
                      label_fireplace: "Kaminmodus",
                      boost_active: "Aktiv",
                      boost_back_to_speed_prefix: 'Zurück zu Lüfterstufe "',
                      boost_back_to_speed_suffix: '" in'
                    },
                    en: {
                      temp_titles: ["Outdoor air", "Supply air", "Extract air", "Exhaust air"],
                      page2_title: "Set fan speed",
                      page3_title: "Boost / Reduced Air Timer",
                      label_fanspeed: "Fan speed",
                      label_minutes: "Minutes",
                      label_fireplace: "Fireplace mode",
                      boost_active: "Active",
                      boost_back_to_speed_prefix: 'Back to fan speed "',
                      boost_back_to_speed_suffix: '" in'
                    },
                    fr: {
                      temp_titles: ["Air extérieur", "Air soufflé", "Air extrait", "Air rejeté"],
                      page2_title: "Régler la vitesse",
                      page3_title: "Minuterie Boost / Réduction",
                      label_fanspeed: "Vitesse du ventilateur",
                      label_minutes: "Minutes",
                      label_fireplace: "Mode cheminée",
                      boost_active: "Actif",
                      boost_back_to_speed_prefix: 'Retour à la vitesse "',
                      boost_back_to_speed_suffix: '" dans'
                    },
                    es: {
                      temp_titles: ["Aire exterior", "Impulsión", "Extracción", "Expulsión"],
                      page2_title: "Ajustar velocidad",
                      page3_title: "Temporizador Boost / Reducción",
                      label_fanspeed: "Velocidad del ventilador",
                      label_minutes: "Minutos",
                      label_fireplace: "Modo chimenea",
                      boost_active: "Activo",
                      boost_back_to_speed_prefix: 'Volver a velocidad "',
                      boost_back_to_speed_suffix: '" en'
                    },
                    nl: {
                      temp_titles: ["Buitenlucht", "Toevoer", "Afvoer", "Uitblaas"],
                      page2_title: "Ventilatiestand instellen",
                      page3_title: "Boost / Verlaagd debiet timer",
                      label_fanspeed: "Ventilatiestand",
                      label_minutes: "Minuten",
                      label_fireplace: "Haardmodus",
                      boost_active: "Actief",
                      boost_back_to_speed_prefix: 'Terug naar stand "',
                      boost_back_to_speed_suffix: '" over'
                    },
                    da: {
                      temp_titles: ["Udeluft", "Tilluft", "Fraluft", "Afluft"],
                      page2_title: "Indstil ventilationsniveau",
                      page3_title: "Boost / Reduceret ventilation",
                      label_fanspeed: "Ventilationsniveau",
                      label_minutes: "Minutter",
                      label_fireplace: "Pejsetilstand",
                      boost_active: "Aktiv",
                      boost_back_to_speed_prefix: 'Tilbage til ventilationsniveau "',
                      boost_back_to_speed_suffix: '" om'
                    },
                    sv: {
                      temp_titles: ["Uteluft", "Tilluft", "Frånluft", "Avluft"],
                      page2_title: "Ställ in fläkthastighet",
                      page3_title: "Boost / Reducerad ventilation",
                      label_fanspeed: "Fläkthastighet",
                      label_minutes: "Minuter",
                      label_fireplace: "Eldstadsläge",
                      boost_active: "Aktiv",
                      boost_back_to_speed_prefix: 'Tillbaka till fläkthastighet "',
                      boost_back_to_speed_suffix: '" om'
                    },
                    no: {
                      temp_titles: ["Uteluft", "Tilluft", "Avtrekksluft", "Avkastluft"],
                      page2_title: "Still inn ventilasjonsnivå",
                      page3_title: "Boost / Redusert ventilasjon",
                      label_fanspeed: "Ventilasjonsnivå",
                      label_minutes: "Minutter",
                      label_fireplace: "Peismodus",
                      boost_active: "Aktiv",
                      boost_back_to_speed_prefix: 'Tilbake til ventilasjonsnivå "',
                      boost_back_to_speed_suffix: '" om'
                    },
                    fi: {
                      temp_titles: ["Ulkoilma", "Tuloilma", "Poistoilma", "Jäteilma"],
                      page2_title: "Aseta ilmanvaihtotaso",
                      page3_title: "Tehostus / Vähennetty ilmanvaihto",
                      label_fanspeed: "Ilmanvaihtotaso",
                      label_minutes: "Minuuttia",
                      label_fireplace: "Takkatila",
                      boost_active: "Aktiivinen",
                      boost_back_to_speed_prefix: 'Takaisin ilmanvaihtotasolle "',
                      boost_back_to_speed_suffix: '" kuluttua'
                    }
                  };  // <-- defaults-Objekt hier schließen (nicht innerhalb von fi!)
                  const data = {
                    lang: detectLang(),
                    strings: defaults
                  };
                  localStorage.setItem(KEY, JSON.stringify(data));
                  return "";
                ]]]
          - type: conditional
            conditions:
              - entity: input_number.ventilation_display_select
                state: "1.0"
            elements:
              - type: image
                image: /local/community/helios_vallox_ventilation/rc_buttontexts.png
                card_mod: null
                tap_action:
                  action: null
                style:
                  top: 50%
                  left: 50%
                  width: 100%
                  transform: translate(-50%, -50%)
              - name: On Off Button
                type: custom:button-card
                template: ventilation_remote_control_leds
                entity: switch.ventilation_powerstate
                tap_action:
                  action: more-info
                style:
                  top: 45%
                  left: 18%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: CO2 Button
                type: custom:button-card
                template: ventilation_remote_control_leds
                entity: switch.ventilation_co2_indicator
                tap_action:
                  action: more-info
                style:
                  top: 45%
                  left: 38%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: RH Button
                type: custom:button-card
                template: ventilation_remote_control_leds
                entity: switch.ventilation_rh_indicator
                tap_action:
                  action: more-info
                style:
                  top: 45%
                  left: 58%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: C Button
                type: custom:button-card
                template: ventilation_remote_control_leds
                entity: switch.ventilation_winter_mode
                tap_action:
                  action: toggle
                style:
                  top: 45%
                  left: 78%
                  width: 5%
                  transform: translate(-50%, -50%)
              - title: Display
                type: custom:button-card
                name: |
                  [[[
                    const index = parseInt(states['input_number.ventilation_display_index'].state);
                    const KEY = "helios.i18n.display";
                    // Sprache bestimmen: localStorage.lang -> hass.language -> navigator.language -> de
                    const getLang = () => {
                      try {
                        const d = JSON.parse(localStorage.getItem(KEY));
                        return d?.lang || "de";
                      } catch (e) { return "de"; }
                    };
                    // Titles laden, mit Fallback auf Deutsch
                    const getTitles = (lang) => {
                      try {
                        const d = JSON.parse(localStorage.getItem(KEY));
                        const cur = d?.strings?.[lang];
                        const de  = d?.strings?.de;
                        if (cur && !Array.isArray(cur) && Array.isArray(cur.temp_titles)) return cur.temp_titles;
                        if (Array.isArray(cur)) return cur;
                        if (de && !Array.isArray(de) && Array.isArray(de.temp_titles)) return de.temp_titles;
                        if (Array.isArray(de)) return de;
                        return ["Außenluft","Zuluft","Abluft","Fortluft"];
                      } catch (e) { return ["Außenluft","Zuluft","Abluft","Fortluft"]; }
                    };
                    const lang = getLang();
                    const titles = getTitles(lang);
                    const entities = [
                      'sensor.ventilation_temperature_outdoor_air',
                      'sensor.ventilation_temperature_supply_air',
                      'sensor.ventilation_temperature_extract_air',
                      'sensor.ventilation_temperature_exhaust_air'
                    ];
                    const zeile1 = titles[index] ?? '';
                    const zeile2 = states[entities[index]]?.state ?? '-';
                    return `<div class="lcd">
                              <div class="l1">${zeile1}</div>
                              <div class="l2">${zeile2} °C</div>
                            </div>`;
                  ]]]
                style:
                  left: 57%
                  top: 78%
                styles:
                  card:
                    - padding: 0
                    - margin: 0
                    - color: black
                    - background-color: "#5CCA03"
                    - border: 2px inset lightgrey
                    - display: |
                        [[[
                          return (states['switch.ventilation_powerstate'].state !== 'on') ? 'none' : 'block';
                        ]]]
                  name:
                    - padding: 0
                    - margin: 0
                card_mod:
                  style: >
                    :host, ha-card { 
                      width: 83% !important;
                      height: 35% !important;
                    } ha-card { box-sizing: border-box; } #name, #name * {
                    box-sizing: border-box; } #name .lcd{
                      width: 100%;
                      justify-content: center;
                      white-space: nowrap;
                      overflow: hidden;
                      text-overflow: ellipsis;
                      line-height: 1.05;
                    } #name .l1{
                      font-size: clamp(16px, 1.6vw, 20px);
                      font-weight: 700;
                    } #name .l2{
                      font-size: clamp(16px, 1.6vw, 20px);
                      font-weight: 400;
                    }
              - name: Display Up Button
                type: custom:button-card
                template: ventilation_remote_control_buttons
                tap_action:
                  action: call-service
                  service: input_number.set_value
                  target:
                    entity_id: input_number.ventilation_display_index
                  data:
                    value: |
                      [[[
                        let index = parseInt(states['input_number.ventilation_display_index'].state);
                        let max_index = 3;
                        let newlevel = 0;
                        if (index < max_index) { newlevel = index + 1 };
                        return newlevel;
                      ]]]
                style:
                  top: 87%
                  left: 18%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: Display Down Button
                type: custom:button-card
                template: ventilation_remote_control_buttons
                tap_action:
                  action: call-service
                  service: input_number.set_value
                  target:
                    entity_id: input_number.ventilation_display_index
                  data:
                    value: |
                      [[[
                        let index = parseInt(states['input_number.ventilation_display_index'].state);
                        let min_index = 0;
                        let newlevel = 3;
                        if (index > min_index) { newlevel = index - 1 };
                        return newlevel;
                      ]]]
                style:
                  top: 87%
                  left: 38%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: Plus Button
                type: custom:button-card
                template: ventilation_remote_control_buttons
                tap_action:
                  action: call-service
                  service: helios_vallox_ventilation.write_value
                  service_data:
                    variable: fanspeed
                    value: |
                      [[[
                        let current_speed = parseInt(states['sensor.ventilation_fanspeed'].state);
                        if (current_speed < 8) {
                          return current_speed + 1
                        } else {
                          return current_speed
                        }
                      ]]]
                style:
                  top: 87%
                  left: 58%
                  width: 5%
                  transform: translate(-50%, -50%)
              - name: Minus Button
                type: custom:button-card
                template: ventilation_remote_control_buttons
                tap_action:
                  action: call-service
                  service: helios_vallox_ventilation.write_value
                  service_data:
                    variable: fanspeed
                    value: |
                      [[[
                        let current_speed = parseInt(states['sensor.ventilation_fanspeed'].state);
                        if (current_speed > 1) {
                          return current_speed - 1
                        } else {
                          return current_speed
                        }
                      ]]]
                style:
                  top: 87%
                  left: 78%
                  width: 5%
                  transform: translate(-50%, -50%)
          - name: Fan speed buttons
            type: conditional
            conditions:
              - entity: input_number.ventilation_display_select
                state: "2.0"
            elements:
              - type: custom:button-card
                title: Set fan speed header
                name: |
                  [[[
                    const KEY="helios.i18n.display";
                    try {
                      const d = JSON.parse(localStorage.getItem(KEY));
                      const lang = d?.lang || "de";
                      const s = d?.strings?.[lang] || d?.strings?.de || {};
                      return s.page2_title || "Set fan speed";
                    } catch (e) { return "Set fan speed"; }
                  ]]]
                tap_action:
                  action: none
                style:
                  left: 50%
                  top: 45%
                  width: 68%
                  transform: translate(-50%, -50%)
                card_mod:
                  style: |
                    ha-card { height: 2em !important; }
                styles:
                  card:
                    - background-color: rgba(92, 202, 3, 0.5)
                    - border: 2px inset
                    - border-radius: 5px
                    - box-shadow: 0 1px 2px rgba(0,0,0,0.15)
                    - padding: 0
                    - margin: 0
                  name:
                    - color: black
                    - font-size: clamp(16px, 1.4vw, 18px)
                    - font-weight: 600
                    - text-align: center
              - type: custom:button-card
                title: Fan Speed Buttons
                style:
                  top: 50%
                  left: 50%
                  width: 93%
                  transform: translate(-50%, 20%)
                card_mod:
                  style: |
                    ha-card { 
                      background: transparent;
                      width: 78% !important;
                      margin-left: 12%;
                    }
                styles:
                  card:
                    - padding: 1%
                  grid:
                    - grid-template-areas: |
                        'speed_header'
                        'speed_buttons'
                    - gap: .5em
                  custom_fields:
                    speed_buttons:
                      - align-self: center
                      - background-color: transparent
                      - border: none
                custom_fields:
                  speed_buttons:
                    card:
                      type: grid
                      columns: 4
                      cards:
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 1
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 2
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 3
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 4
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 5
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 6
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 7
                        - type: custom:button-card
                          template: ventilation_fan_speed_buttons
                          variables:
                            value: 8
          - name: Timed boost
            type: conditional
            conditions:
              - entity: input_number.ventilation_display_select
                state: "3.0"
            elements:
              - type: custom:button-card
                title: Timed boost header
                name: |
                  [[[
                    const KEY="helios.i18n.display";
                    try {
                      const d = JSON.parse(localStorage.getItem(KEY));
                      const lang = d?.lang || "de";
                      const s = d?.strings?.[lang] || d?.strings?.de || {};
                      return s.page3_title || "Boost / Reduced Air Timer";
                    } catch (e) { return "Boost / Reduced Air Timer"; }
                  ]]]
                tap_action:
                  action: none
                style:
                  left: 50%
                  top: 45%
                  width: 68%
                  transform: translate(-50%, -50%)
                card_mod:
                  style: |
                    ha-card { height: 2em !important; }
                styles:
                  card:
                    - background-color: rgba(92, 202, 3, 0.5)
                    - border: 2px inset
                    - border-radius: 5px
                    - box-shadow: 0 1px 2px rgba(0,0,0,0.15)
                    - padding: 0
                    - margin: 0
                  name:
                    - color: black
                    - font-size: clamp(16px, 1.4vw, 18px)
                    - font-weight: 600
                    - text-align: center
              - type: custom:button-card
                style:
                  top: 58%
                  left: 50%
                  width: 88%
                  transform: translate(-50%, -10%)
                card_mod:
                  style: |
                    ha-card { 
                      background: transparent;
                      width: 80% !important;
                      margin-left: 10%
                    }
                styles:
                  card:
                    - padding: 1%
                  grid:
                    - grid-template-areas: |
                        'boost_settings boost_settings'
                        'fireplace start_stop'
                    - gap: .5em
                  custom_fields:
                    boost_settings:
                      - background-color: transparent
                      - margin-bottom: 10px
                    fireplace:
                      - justify-self: start
                      - align-self: center
                    start_stop:
                      - justify-self: end
                      - align-self: center
                      - margin-right: 10px
                      - background-color: transparent
                custom_fields:
                  boost_settings:
                    card:
                      type: custom:button-card
                      name: |
                        [[[
                          const KEY="helios.i18n.display";
                          let s = {};
                          try {
                            const d = JSON.parse(localStorage.getItem(KEY));
                            const lang = d?.lang || "de";
                            s = d?.strings?.[lang] || d?.strings?.de || {};
                          } catch (e) {}
                          if(states['input_boolean.ventilation_manual_boost_active'].state === 'on') {
                            const orig = parseInt(states['input_number.ventilation_manual_boost_original_fanspeed'].state);
                            return '<h1 style="margin-top: -0.2em; margin-bottom: 0.25em;">' +
                                    (s.boost_active || "Active") +
                                   '</h1>' +
                                   '<div style="color: black; margin-top: -0.5em;">' +
                                    (s.boost_back_to_speed_prefix || 'Back to fan speed "') +
                                    orig +
                                    (s.boost_back_to_speed_suffix || '" in') +
                                   '</div>';
                          }
                          return ' ';
                        ]]]
                      styles:
                        grid:
                          - grid-template-areas: |
                              "fanspeed"
                              "duration"
                              "timer"
                          - height: 7em
                        card:
                          - background: none
                          - border-radius: 12px
                          - box-shadow: |
                              [[[
                                if(states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                                  return 'inset 0px 0px 10px 2px #5CCA03'
                                else
                                  return 'none';
                              ]]]          
                          - color: black
                          - border: 1px lightgrey solid
                          - margin-top: 10px
                        name:
                          - color: "#5CCA03"
                          - position: absolute
                          - top: 2em
                          - left: 0
                          - right: 0
                          - width: 100%
                          - text-align: center
                        custom_fields:
                          fanspeed:
                            - background-color: transparent
                            - display: |
                                [[[
                                  if(states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                                    return 'none';
                                ]]]
                            - margin-left: 10px
                            - margin-right: 10px
                          duration:
                            - background-color: transparent
                            - margin-top: 10px
                            - display: |
                                [[[
                                  if(states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                                    return 'none';
                                ]]]
                            - margin-left: 10px
                            - margin-right: 10px
                          timer:
                            - color: black
                            - background: "#5CCA03"
                            - border-radius: 12px
                            - margin-left: 0.5em
                            - margin-right: 0.5em
                            - font-size: 2em
                            - display: |
                                [[[
                                  if(states['input_boolean.ventilation_manual_boost_active'].state === 'off')
                                    return 'none';
                                ]]]
                      custom_fields:
                        fanspeed:
                          card:
                            name: |
                              [[[
                                const KEY="helios.i18n.display";
                                try {
                                  const d = JSON.parse(localStorage.getItem(KEY));
                                  const lang = d?.lang || "de";
                                  const s = d?.strings?.[lang] || d?.strings?.de || {};
                                  return s.label_fanspeed || "Fan speed";
                                } catch (e) { return "Fan speed"; }
                              ]]]
                            type: tile
                            entity: input_number.ventilation_manual_boost_level
                            show_entity_picture: true
                            hide_state: true
                            features_position: inline
                            features:
                              - type: numeric-input
                                style: buttons
                            card_mod:
                              style: |
                                ha-card { 
                                    background: #5CCA03;
                                    color: black;
                                    --primary-text-color: black;
                                    --ha-card-border-radius: 12px;
                                }
                                ha-state-icon {
                                  color: black;
                                }
                                ha-tile-icon {}
                        duration:
                          card:
                            name: |
                              [[[
                                const KEY="helios.i18n.display";
                                try {
                                  const d = JSON.parse(localStorage.getItem(KEY));
                                  const lang = d?.lang || "de";
                                  const s = d?.strings?.[lang] || d?.strings?.de || {};
                                  return s.label_minutes || "Minutes";
                                } catch (e) { return "Minutes"; }
                              ]]]
                            type: tile
                            entity: input_number.ventilation_manual_boost_time
                            show_entity_picture: true
                            hide_state: true
                            features_position: inline
                            features:
                              - type: numeric-input
                                style: buttons
                            card_mod:
                              style: |
                                ha-card { 
                                    background: #5CCA03;
                                    color: black;
                                    --primary-text-color: black;
                                    --ha-card-border-radius: 12px;
                                }
                                ha-state-icon {
                                  color: black;
                                }
                                ha-tile-icon {}
                        timer:
                          card:
                            type: tile
                            entity: timer.ventilation_manual_boost_timer
                            name: " "
                            show_entity_picture: false
                            show_name: false
                            card_mod:
                              style: |
                                ha-card {
                                  color: black;
                                  background: none;
                                  border: none;
                                  box-shadow: none;
                                  padding: 0;
                                  display: flex;
                                  text-align: center;
                                  justify-content: center;
                                  align-items: center;
                                }
                                ha-state-icon,
                                ha-tile-icon,
                                ha-tile-name,
                                ha-progress-bar {
                                  display: none !important;
                                }
                  fireplace:
                    card:
                      type: custom:button-card
                      name: |
                        [[[
                          const KEY="helios.i18n.display";
                          try {
                            const d = JSON.parse(localStorage.getItem(KEY));
                            const lang = d?.lang || "de";
                            const s = d?.strings?.[lang] || d?.strings?.de || {};
                            return s.label_fireplace || "Fireplace mode";
                          } catch (e) { return "Fireplace mode"; }
                        ]]]
                      entity: input_boolean.ventilation_manual_boost_fireplace_mode
                      show_icon: true
                      show_name: true
                      show_state: false
                      state:
                        - value: "on"
                          styles:
                            icon:
                              - color: "#5CCA03"
                        - value: "off"
                          styles:
                            icon:
                              - color: lightgrey
                      tap_action:
                        action: toggle
                      styles:
                        card:
                          - background: transparent
                          - border: none
                          - box-shadow: none
                          - padding: 0px
                          - margin: 0px
                          - display: |
                              [[[
                                if(states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                                  return 'none';
                              ]]]
                        grid:
                          - grid-template-areas: "\"i n\""
                          - grid-template-columns: min-content auto
                          - align-items: center
                        icon:
                          - width: 30px
                          - margin-left: 10px
                          - margin-right: 5px;
                        name:
                          - justify-self: start
                          - align-self: center
                          - font-weight: bold
                          - color: black
                          - line-height: 1
                          - padding-top: 2px
                          - font-size: 14px
                  start_stop:
                    card:
                      type: custom:button-card
                      show_name: true
                      show_icon: false
                      icon: mdi:play
                      tap_action:
                        action: call-service
                        service: |
                          [[[
                            return (states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                              ? 'script.ventilation_stop_manual_boost'
                              : 'script.ventilation_start_manual_boost';
                          ]]]        
                      name: |
                        [[[
                          return (states['input_boolean.ventilation_manual_boost_active'].state === 'on')
                            ? '⏹ Stop'
                            : 'Start ⏵';
                        ]]]
                      styles:
                        card:
                          - color: black
                          - background: transparent
          - type: custom:button-card
            entity: none
            tap_action:
              action: null
            show_name: false
            show_state: false
            show_icon: false
            style:
              top: 27%
              left: 51%
              width: 73%
              transform: translate(-50%, -50%)
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - padding: 8px
                - min-height: 2em
              grid:
                - grid-template-areas: "\"infobtn speedbtn timerbtn\""
                - grid-template-columns: 1fr 1fr 1fr
                - gap: 10px
              custom_fields:
                infobtn:
                  - width: 100%
                  - height: 100%
                  - justify-self: start
                speedbtn:
                  - width: 100%
                  - height: 100%
                  - justify-self: center
                timerbtn:
                  - width: 100%
                  - height: 100%
                  - justify-self: end
            custom_fields:
              infobtn:
                card:
                  type: custom:button-card
                  template: ventilation_remote_control_displayselect
                  aspect_ratio: 2/1
                  icon: mdi:information-outline
                  variables:
                    value: 1
              speedbtn:
                card:
                  type: custom:button-card
                  template: ventilation_remote_control_displayselect
                  aspect_ratio: 2/1
                  icon: mdi:fan-plus
                  variables:
                    value: 2
              timerbtn:
                card:
                  type: custom:button-card
                  template: ventilation_remote_control_displayselect
                  aspect_ratio: 2/1
                  icon: mdi:fan-clock
                  variables:
                    value: 3
      - square: false
        type: grid
        grid_options:
          columns: full
          rows: auto
        columns: 2
        cards:
          - type: custom:button-card
            aspect_ratio: 1
            custom_fields:
              gauge:
                card:
                  name: Lüftungsstufe
                  type: gauge
                  entity: sensor.ventilation_fanspeed
                  needle: true
                  min: 0
                  max: 9
                  segments:
                    - from: 0
                      color: "#3899E1"
                    - from: 0.5
                      color: white
                    - from: 1.5
                      color: "#3899E1"
                    - from: 2.5
                      color: white
                    - from: 3.5
                      color: "#3899E1"
                    - from: 4.5
                      color: white
                    - from: 5.5
                      color: "#3899E1"
                    - from: 6.5
                      color: white
                    - from: 7.5
                      color: "#3899E1"
                    - from: 8.5
                      color: white
                  card_mod:
                    style: |
                      ha-card {
                        --ha-card-background: transparent;
                        --ha-card-border-color: rgba(0,0,0,0);
                        --ha-card-border-radius: 0px;
                        --ha-card-border-width: 0px;
                      }
            styles:
              custom_fields:
                gauge:
                  - position: absolute
                  - top: 50%
                  - left: 50%
                  - width: 100%
                  - transform: translate(-50%, -50%)
              card:
                - overflow: hidden
                - box-shadow: none
            card_mod:
              style: |
                ha-card {
                  --ha-card-background: transparent;
                  --ha-card-border-color: rgba(0,0,0,0);
                  --ha-card-border-radius: 0px;
                  --ha-card-border-width: 0px;
                }
          - name: Effizienz
            type: gauge
            entity: sensor.ventilation_efficiency
            card_mod:
              style: |
                ha-card {
                  --ha-card-background: transparent;
                  --ha-card-border-color: rgba(0,0,0,0);
                  --ha-card-border-radius: 0px;
                  --ha-card-border-width: 0px;
                }
    column_span: 1
  - type: grid
    cards:
      - type: heading
        icon: " "
        heading_style: title
        style: |
          ha-card {
            height: 240px;
            background: transparent;
            border: none;
            box-shadow: none;
            padding: 0;
          }
      - type: markdown
        content: |-
          <div style="font-size:200%;">
          <table height="100%" width="100%">

           <colgroup>
              <col width=70%>
              <col width=30%>
           </colgroup>

            <tr align=right>
              <td align=left><small><b>DIN: Luftmengen für dieses Haus</b></small></td>
              <td><small><b>Luftaustausch</b></small></td>
            </tr>
            
            <tr align=right>
              <td align=left>Feuchteschutz</td>
              <td>{{ states('sensor.ventilation_din_airflow_moisture_protection') }} m³/h</td>
            </tr>
            
            <tr align=right>
              <td align=left>Reduzierte Lüftung</td>
              <td>{{ states('sensor.ventilation_din_airflow_reduced_exchange') }} m³/h</td>
            </tr>
            
            <tr align=right>
              <td align=left>Normale Lüftung</td>
              <td>{{ states('sensor.ventilation_din_airflow_normal_exchange') }} m³/h</td>
            </tr>
            
            <tr align=right>
              <td align=left>Stoßlüftung</td>
              <td>{{ states('sensor.ventilation_din_airflow_boost_exchange') }} m³/h</td>
            </tr>
            
          </table> </div>
        text_only: true
        card_mod:
          style:
            .: |
              ha-card {
                background: transparent;
                --ha-card-border-color: rgba(0,0,0,0);
                --ha-card-border-radius: 0px;
                --ha-card-border-width: 0px;
                margin-bottom: 2.5em;
              }
            ha-markdown $: |
              tbody tr:nth-child(1) {
                background-color: white;
                color: black;
              }
              tbody tr:nth-child(2) {
                background-color: #FF5F15;
              }
              tbody tr:nth-child(3) {
                background-color: #DAA520;
              }
              tbody tr:nth-child(4) {
                background-color: #228B22;
              }
              tbody tr:nth-child(5) {
                background-color: #DAA520;
              }
              tbody tr:first-child :first-child {
                border-top-left-radius: 6px;
              }
              tbody tr:first-child :last-child {
                border-top-right-radius: 6px;
              }
              tbody tr:last-child :first-child {
                border-bottom-left-radius: 6px;
              }
              tbody tr:last-child :last-child {
                border-bottom-right-radius: 6px;
              }
      - type: picture-elements
        name: temperatures
        show_state: false
        show_name: false
        image: /local/community/helios_vallox_ventilation/temperature-balance.png
        card_mod:
          style: |
            ha-card { 
              background: transparent;
              --ha-card-border-color: rgba(0,0,0,0);
              --ha-card-border-radius: 0px;
              --ha-card-border-width: 0px;
            }
        elements:
          - type: custom:button-card
            entity: sensor.ventilation_temperature_exhaust_air
            show_icon: false
            show_name: false
            show_state: true
            state_display: |
              [[[ 
                const v = Number(entity.state);
                if (isNaN(v)) return '–';
                return `${Math.round(v)} °C`;
              ]]]
            tap_action:
              action: more-info
            style:
              left: 10%
              top: 91%
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - border-radius: 0
                - padding: 0
              state:
                - font-size: 1.2em
                - font-style: bold
                - font-weight: 700
                - color: white
                - justify-self: start
                - align-self: end
          - type: custom:button-card
            entity: sensor.ventilation_temperature_supply_air
            show_icon: false
            show_name: false
            show_state: true
            state_display: |
              [[[ 
                const v = Number(entity.state);
                if (isNaN(v)) return '–';
                return `${Math.round(v)} °C`;
              ]]]
            tap_action:
              action: more-info
            style:
              left: 88%
              top: 91%
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - border-radius: 0
                - padding: 0
              state:
                - font-size: 1.2em
                - font-style: bold
                - font-weight: 700
                - color: white
                - justify-self: end
                - align-self: end
          - type: custom:button-card
            entity: sensor.ventilation_temperature_outdoor_air
            show_icon: false
            show_name: false
            show_state: true
            state_display: |
              [[[ 
                const v = Number(entity.state);
                if (isNaN(v)) return '–';
                return `${Math.round(v)} °C`;
              ]]]
            tap_action:
              action: more-info
            style:
              left: 7%
              top: 7%
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - border-radius: 0
                - padding: 0
              state:
                - font-size: 1.2em
                - font-style: bold
                - font-weight: 700
                - color: white
                - justify-self: start
                - align-self: end
          - type: custom:button-card
            entity: sensor.ventilation_temperature_extract_air
            show_icon: false
            show_name: false
            show_state: true
            state_display: |
              [[[ 
                const v = Number(entity.state);
                if (isNaN(v)) return '–';
                return `${Math.round(v)} °C`;
              ]]]
            tap_action:
              action: more-info
            style:
              left: 88%
              top: 10%
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - border-radius: 0
                - padding: 0
              state:
                - font-size: 1.2em
                - font-style: bold
                - font-weight: 700
                - color: white
                - justify-self: end
                - align-self: end
          - type: custom:button-card
            entity: sensor.ventilation_temperature_balance
            show_icon: false
            show_name: false
            show_state: true
            state_display: |
              [[[ 
                const v = Number(entity.state);
                if (isNaN(v)) return '–';
                const r = Math.round(v);
                if (r > 0)  return `Balance:<br/>∆T = +${r} °C`;
                if (r < 0)  return `Balance:<br/>∆T = ${r} °C`;
                return `Balance:<br/>∆T = ±0 °C`;
              ]]]
            tap_action:
              action: more-info
            style:
              left: 49%
              top: 49%
              width: 120px
              transform: translate(-50%, -50%)
            styles:
              card:
                - background: transparent
                - box-shadow: none
                - border-radius: 0
                - padding: 0
                - width: 120px
                - height: auto
              state:
                - font-size: 1.2em
                - font-weight: 500
                - color: black
                - justify-self: center
                - align-self: center
                - text-align: center
      - square: false
        type: grid
        grid_options:
          columns: 12
          rows: auto
        columns: 2
        cards:
          - square: true
            type: grid
            grid_options:
              columns: 12
              rows: auto
            columns: 1
            cards:
              - name: Luftaustausch
                type: gauge
                entity: sensor.ventilation_effective_airflow
                needle: true
                min: 0
                max: 360
                segments:
                  - from: 0
                    color: "#FF0000"
                  - from: 5.56
                    color: "#FF150B"
                  - from: 11.11
                    color: "#FF2A16"
                  - from: 16.67
                    color: "#FF3F22"
                  - from: 22.22
                    color: "#FF542D"
                  - from: 27.78
                    color: "#FF6A38"
                  - from: 33.33
                    color: "#FF7F44"
                  - from: 38.89
                    color: "#FF944F"
                  - from: 44.44
                    color: "#FFA95A"
                  - from: 50
                    color: "#FFBF66"
                  - from: 57.78
                    color: "#FFC562"
                  - from: 65.56
                    color: "#FFCB5E"
                  - from: 73.33
                    color: "#FFD25A"
                  - from: 81.11
                    color: "#FFD856"
                  - from: 88.89
                    color: "#FFDF52"
                  - from: 96.67
                    color: "#FFE54E"
                  - from: 104.44
                    color: "#FFEC4A"
                  - from: 112.22
                    color: "#FFF246"
                  - from: 120
                    color: "#FFF942"
                  - from: 124.44
                    color: "#E2F93A"
                  - from: 128.89
                    color: "#C6FA33"
                  - from: 133.33
                    color: "#AAFB2C"
                  - from: 137.78
                    color: "#8DFB24"
                  - from: 142.22
                    color: "#71FC1D"
                  - from: 146.67
                    color: "#55FD16"
                  - from: 151.11
                    color: "#38FD0E"
                  - from: 155.56
                    color: "#1CFE07"
                  - from: 160
                    color: "#00FF00"
                  - from: 163.33
                    color: "#1BFE01"
                  - from: 166.67
                    color: "#37FE03"
                  - from: 170
                    color: "#53FE05"
                  - from: 173.33
                    color: "#6FFE07"
                  - from: 176.67
                    color: "#8AFE08"
                  - from: 180
                    color: "#A6FE0A"
                  - from: 183.33
                    color: "#C2FE0C"
                  - from: 186.67
                    color: "#DEFE0E"
                  - from: 190
                    color: "#FAFE10"
                  - from: 198.89
                    color: "#FAF619"
                  - from: 207.78
                    color: "#FBEF22"
                  - from: 216.67
                    color: "#FBE82C"
                  - from: 225.56
                    color: "#FCE135"
                  - from: 234.44
                    color: "#FCDA3E"
                  - from: 243.33
                    color: "#FDD348"
                  - from: 252.22
                    color: "#FDCC51"
                  - from: 261.11
                    color: "#FEC55A"
                  - from: 270
                    color: "#FFBE64"
                  - from: 280
                    color: "#FFA858"
                  - from: 290
                    color: "#FF934D"
                  - from: 300
                    color: "#FF7E42"
                  - from: 310
                    color: "#FF6937"
                  - from: 320
                    color: "#FF542C"
                  - from: 330
                    color: "#FF3F21"
                  - from: 340
                    color: "#FF2A16"
                  - from: 350
                    color: "#FF150B"
                  - from: 360
                    color: "#FF0000"
                card_mod:
                  style: |
                    ha-card {
                      --ha-card-background: transparent;
                      --ha-card-border-color: rgba(0,0,0,0);
                      --ha-card-border-radius: 0px;
                      --ha-card-border-width: 0px;
                    }
          - type: custom:button-card
            aspect_ratio: 1
            custom_fields:
              gauge:
                card:
                  type: gauge
                  name: Energieverbrauch
                  entity: sensor.ventilation_electrical_power
                  min: 0
                  max: |
                    [[[
                      let all = JSON.parse("[" + states['input_text.ventilation_conf_power_per_mode'].state + "]");
                      let mode = parseInt(states['sensor.ventilation_fanspeed'].state);
                      return all[8];
                    ]]]
                  needle: true
                  severity:
                    green: 0
                    yellow: 100
                    red: 150
            styles:
              custom_fields:
                gauge:
                  - position: absolute
                  - top: 50%
                  - left: 50%
                  - width: 100%
                  - transform: translate(-50%, -50%)
              card:
                - overflow: hidden
                - box-shadow: none
            card_mod:
              style: |
                ha-card {
                  --ha-card-background: transparent;
                  --ha-card-border-color: rgba(0,0,0,0);
                  --ha-card-border-radius: 0px;
                  --ha-card-border-width: 0px;
                }
  - type: grid
    cards:
      - type: custom:plotly-graph
        grid_options:
          columns: 24
          rows: auto
        hours_to_show: 168
        refresh_interval: 300
        card_mod:
          style:
            .: |
              ha-card { 
                --ha-card-border-width: 0px;
                --ha-card-border-radius: 0px; 
                --ha-card-border-color: #grey;
                --card-mod-icon-color: white;
                padding: 0;
                height: 75vh;
                margin-top: 3em;
                width: 100% !important;
                background: transparent;
              }
        defaults:
          xaxes:
            showgrid: true
            gridcolor: rgba(255,255,255,0.12)
            gridwidth: 1
            showline: true
            linewidth: 1
            fixedrange: false
            zeroline: false
            mirror: true
          yaxes:
            type: number
            title: ""
            fixedrange: true
            visible: true
            overlaying: false
            tickfont:
              color: grey
            showgrid: true
            gridcolor: rgba(255,255,255,0.12)
            gridwidth: 1
            side: left
            mirror: true
          entity:
            xaxis: x
            yaxis: "y"
        config:
          displaylogo: false
          responsive: true
        layout:
          paper_bgcolor: transparent
          plot_bgcolor: transparent
          margin:
            b: 15
            t: 0
            l: 45
            r: 10
            pad: 0
          grid:
            rows: 3
            columns: 1
            pattern: independent
            roworder: top to bottom
            ygap: 0.1
          showlegend: true
          legend:
            orientation: h
            x: 0
            "y": 1.01
          hovermode: x unified
          hoversubplots: axis
          hoverdistance: -1
          spikedistance: -1
          xaxis:
            title: ""
            tickformat: "%a %H:%M"
            showlegend: true
            mirror: true
            showspikes: true
            spikemode: across
            spikesnap: cursor
            spikethickness: 0.5
            spikecolor: rgba(255,255,255,0.35)
            showticklabels: false
            rangeselector:
              x: 1
              xanchor: right
              "y": 1.01
              yanchor: bottom
              buttons:
                - count: 12
                  step: hour
                - count: 1
                  step: day
                - count: 2
                  step: day
                - count: 7
                  step: day
          xaxis2:
            showspikes: true
            spikemode: across
            spikesnap: cursor
            title: ""
            mirror: true
            showline: true
            matches: x
            gridcolor: rgba(255,255,255,0.12)
            showticklabels: false
          xaxis3:
            showspikes: true
            spikemode: across
            spikesnap: cursor
            title: ""
            mirror: true
            showline: true
            matches: x
            gridcolor: rgba(255,255,255,0.12)
            showticklabels: true
            tickformat: "%a %H:%M"
          yaxis:
            showline: true
            showticklabels: true
            ticks: inside
            side: left
            range: auto
            position: 0.1
          yaxis2:
            side: left
            showline: true
            showticklabels: true
            ticks: inside
            range:
              - 60
              - 100
          yaxis3:
            showline: true
            showticklabels: true
            ticks: inside
            side: left
            range:
              - 0
              - 8
          annotations:
            - text: Temperaturen °C
              x: 0.01
              xref: paper
              xanchor: left
              "y": 1
              yref: paper
              showarrow: false
              font:
                color: rgba(255, 255, 255, 0.5)
                size: 14
            - text: Effizienz %
              x: 0.01
              xref: paper
              xanchor: left
              "y": 0.64
              yref: paper
              showarrow: false
              font:
                color: rgba(255, 255, 255, 0.5)
                size: 14
            - text: Lüftungsstufe
              x: 0.01
              xref: paper
              xanchor: left
              "y": 0.28
              yref: paper
              showarrow: false
              font:
                color: rgba(255, 255, 255, 0.5)
                size: 14
        entities:
          - name: Außenluft
            entity: sensor.ventilation_temperature_outdoor_air
            fillcolor: rgba(168, 216, 234, 0.1)
            fill: tozeroy
            line:
              shape: spline
              color: grey
              width: 1
              smoothing: 0.3
          - name: Abluft
            entity: sensor.ventilation_temperature_extract_air
            line:
              shape: spline
              color: "#FF5F15"
              width: 2
              smoothing: 0.3
          - name: Zuluft
            entity: sensor.ventilation_temperature_supply_air
            line:
              shape: spline
              color: "#4BA602"
              width: 2
              smoothing: 0.3
          - name: Fortluft
            entity: sensor.ventilation_temperature_exhaust_air
            line:
              shape: spline
              color: "#DAA520"
              width: 2
              smoothing: 0.3
          - name: Effizienz
            entity: sensor.ventilation_efficiency
            xaxis: x2
            yaxis: y2
            type: scatter
            fill: tozeroy
            line:
              width: 1
              color: "#4BA602"
          - name: Lüftungsstufe
            entity: sensor.ventilation_fanspeed
            xaxis: x3
            yaxis: y3
            type: scatter
            fill: tozeroy
            line:
              width: 1
              color: "#DAA520"
    column_span: 2
